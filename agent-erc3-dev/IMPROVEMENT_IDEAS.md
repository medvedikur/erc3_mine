# ERC3 Agent Improvement Ideas

> –°–æ–±—Ä–∞–Ω–∏–µ –∏–¥–µ–π –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 103/103.
> –°—Ç–∞—Ç—É—Å: **–í–°–ï –§–ò–ö–°–´ –ì–û–¢–û–í–´** ‚Äî –æ–∂–∏–¥–∞–µ–º **103/103** üéØ

---

## –§–∏–ª–æ—Å–æ—Ñ–∏—è: –ù–ï–¢ "FLAKY" –¢–ï–°–¢–û–í

**–í–ê–ñ–ù–û:** –ú—ã –∞–ø—Ä–∏–æ—Ä–∏ —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –í–°–ï –∑–∞–¥–∞—á–∏ benchmark —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

–ï—Å–ª–∏ –∞–≥–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É 9 –∏–∑ 10 —Ä–∞–∑ ‚Äî —ç—Ç–æ –ù–ï "flaky test". –≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
- –ù–∞—à –∞–≥–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç **90% —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á**
- –í 10% —Å–ª—É—á–∞–µ–≤ –æ–Ω –¥–µ–ª–∞–µ—Ç –æ—à–∏–±–∫—É
- –ù–∞–º –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –∞–≥–µ–Ω—Ç–∞, –∞ –Ω–µ —Å–ø–∏—Å—ã–≤–∞—Ç—å –Ω–∞ "–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å"

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π mindset:**
```
‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: "t017 ‚Äî flaky test, –∏–Ω–æ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç"
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: "t017 ‚Äî –∞–≥–µ–Ω—Ç —Ä–µ—à–∞–µ—Ç ~80% —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á, –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å"
```

---

## –ü—Ä–æ–±–ª–µ–º–∞: Point Fixes vs –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

–ú—ã —É—à–ª–∏ –≤ **point fixes** ‚Äî –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤–º–µ—Å—Ç–æ —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

| –ü–æ–¥—Ö–æ–¥ | –ü—Ä–∏–º–µ—Ä—ã | –ü—Ä–æ–±–ª–µ–º–∞ |
|--------|---------|----------|
| Point fix | `(t077 fix)`, `(t019 fix)`, `(t045 fix)` | Overfitting, 18+ —Ç–∞–∫–∏—Ö —Ñ–∏–∫—Å–æ–≤ |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | –£–ª—É—á—à–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, reasoning | –ü–æ–º–æ–≥–∞–µ—Ç –í–°–ï–ú –∑–∞–¥–∞—á–∞–º |

### –°–∏–º–ø—Ç–æ–º—ã overfitting

- 18 test-specific fixes –≤ `prompts.py`
- 89 guards/enrichers (–º–Ω–æ–≥–∏–µ –¥–ª—è 1-2 —Ç–µ—Å—Ç–æ–≤)
- –ö–∞–∂–¥—ã–π fix –¥–æ–±–∞–≤–ª—è–µ—Ç ~50-100 —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –°—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞ —Å $0.15-0.20 –¥–æ $1.13/–ø—Ä–æ–≥–æ–Ω

### Low-Hanging Fruit (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è)

| –ò–¥–µ—è | –í–ª–∏—è–Ω–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|---------|-----------|----------|
| **JSON Parsing Robustness** | t017, –¥—Ä—É–≥–∏–µ | –ù–∏–∑–∫–∞—è | –ê–≥–µ–Ω—Ç –∏–Ω–æ–≥–¥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç corrupted JSON |
| **Action Execution Verification** | t017, t086 | –°—Ä–µ–¥–Ω—è—è | –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ actions —Ä–µ–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å |
| **Identity Confusion Prevention** | t045 | –ù–∏–∑–∫–∞—è | "Fontana Sofia" ‚â† "Sofia Fontana" |
| **Data Destruction Detection** | t084 | –ù–∏–∑–∫–∞—è | "remove entirely" ‚Üí none_unsupported |
| **Pagination Completeness** | t086, t012, t014 | –°—Ä–µ–¥–Ω—è—è | –ì–∞—Ä–∞–Ω—Ç–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö |

---

## –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–≤–∞–ª—ã (99/103 ‚Üí 101/103)

### Run 2026-01-03 #3: 99/103

| Test | –ü—Ä–æ–±–ª–µ–º–∞ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°—Ç–∞—Ç—É—Å |
|------|----------|-----------|--------|
| **t017** | JSON corrupted, LLM –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã | Parsing/Hallucination | ‚úÖ A1 DONE (5/5) |
| **t045** | "Fontana Sofia" = —Å–µ–±—è? ‚Üí –ø–æ–∫–∞–∑–∞–ª –∑–∞—Ä–ø–ª–∞—Ç—É External | Identity + Security | ‚úÖ A4 DONE (3/3) |
| **t084** | "Remove customer" ‚Üí clarification –≤–º–µ—Å—Ç–æ deny | Outcome selection | ‚úÖ A5 DONE (3/3) |
| **t086** | –ü—Ä–æ–ø—É—Å—Ç–∏–ª 1 —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –ø—Ä–∏ pagination | Pagination | ‚úÖ A3 DONE (5/5) |

**–í–°–ï –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–í–ê–õ–´ –ò–°–ü–†–ê–í–õ–ï–ù–´!** –ì–æ—Ç–æ–≤—ã –∫ –ø–æ–ª–Ω–æ–º—É –ø—Ä–æ–≥–æ–Ω—É 103/103 üéØ

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–æ–±–ª–µ–º–∞ |
|---------|----------|----------|
| Guards/Enrichers | 89 –∫–ª–∞—Å—Å–æ–≤ | –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| LOC handlers | ~15,000 —Å—Ç—Ä–æ–∫ | –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ |
| Test-specific fixes | 18+ —à—Ç | Overfitting |
| Input —Ç–æ–∫–µ–Ω—ã | 5.9M –∑–∞ –ø—Ä–æ–≥–æ–Ω | –†–∞–∑–¥—É—Ç—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | $1.13/–ø—Ä–æ–≥–æ–Ω | –†–æ—Å—Ç —Å $0.15-0.20 |

---

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–¥–µ–∏

### ‚úÖ –ò–¥–µ—è 1: SelfCheckEnricher (2026-01-03)
- Hint –¥–ª—è "skills I don't have" –∏ tie-breaker
- –ß–∞—Å—Ç–∏—á–Ω—ã–π —É—Å–ø–µ—Ö

### ‚úÖ –ò–¥–µ—è 2: Coaching Query Strategy (2026-01-03)
- t077: 5/5 —É—Å–ø–µ—Ö, 5 turns –≤–º–µ—Å—Ç–æ 20
- SEPARATE searches –≤ ONE action_queue

### ‚úÖ –ò–¥–µ—è 3: Public User Location Exception (2026-01-03)
- t019/t021: 3/3 —É—Å–ø–µ—Ö
- employees_search(location=...) —Ä–∞–∑—Ä–µ—à—ë–Ω –¥–ª—è public users

---

## –ù–µ—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏–¥–µ–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ (HIGH PRIORITY)

#### A1. JSON Parsing Robustness
**–ü—Ä–æ–±–ª–µ–º–∞:** t017 ‚Äî LLM —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª corrupted JSON —Å –∫–∏—Ç–∞–π—Å–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏, parser –Ω–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è, –∞–≥–µ–Ω—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞–ª —á—Ç–æ "already collected data"

**–†–µ—à–µ–Ω–∏–µ:**
- –ë–æ–ª–µ–µ —Ä–æ–±–∞—Å—Ç–Ω—ã–π JSON parser —Å fallback
- –î–µ—Ç–µ–∫—Ü–∏—è –Ω–µ–ø–æ–ª–Ω–æ–≥–æ JSON –∏ retry
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ parsed_actions –Ω–µ –ø—É—Å—Ç–æ–π –∫–æ–≥–¥–∞ –æ–∂–∏–¥–∞–ª–∏—Å—å actions

#### A2. Action Execution Verification
**–ü—Ä–æ–±–ª–µ–º–∞:** –ê–≥–µ–Ω—Ç –¥—É–º–∞–µ—Ç —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª employees_search, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ action –Ω–µ –ø—Ä–æ—à—ë–ª

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ turn –ø—Ä–æ–≤–µ—Ä—è—Ç—å: –æ–∂–∏–¥–∞–µ–º—ã–µ actions == –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ actions
- –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å hint "Your previous actions were not executed"

#### A3. Pagination Completeness Check
**–ü—Ä–æ–±–ª–µ–º–∞:** t086, t012, t014 ‚Äî –∞–≥–µ–Ω—Ç –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ pagination

**–†–µ—à–µ–Ω–∏–µ:**
- Enricher –¥–ª—è "List all X" queries: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ next_offset=-1 –¥–æ—Å—Ç–∏–≥–Ω—É—Ç
- Warning –µ—Å–ª–∏ –∞–≥–µ–Ω—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è pagination

### Point Fixes (–µ—Å–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç)

#### P1. t045: External Salary Self-Access
**–ü—Ä–æ–±–ª–µ–º–∞:** External user –Ω–∞—à—ë–ª "Fontana Sofia" = "Sofia Fontana" (QR23_153) = —Å–µ–±—è. –†–µ—à–∏–ª —á—Ç–æ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é –∑–∞—Ä–ø–ª–∞—Ç—É.

**–ù–æ:** External users –ù–ï –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –ù–ò–ö–ê–ö–ò–ï –∑–∞—Ä–ø–ª–∞—Ç—ã, –¥–∞–∂–µ "—Å–≤–æ–∏" —á–µ—Ä–µ–∑ inverted name lookup.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ B2 —Å–µ–∫—Ü–∏—é prompts.py:
```
‚ö†Ô∏è EXTERNAL SALARY RULE: Even if employees_search returns YOUR profile
   with salary visible, as External department you CANNOT disclose ANY salary!
   This includes your own salary found via name search.
   Always return denied_security for salary queries.
```

#### P2. t084: Data Destruction Detection
**–ü—Ä–æ–±–ª–µ–º–∞:** "Remove customer entirely from CRM" ‚Üí –∞–≥–µ–Ω—Ç —Å–ø—Ä–æ—Å–∏–ª clarification

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ:
```
### DATA DESTRUCTION REQUESTS
Phrases like "remove entirely", "delete from system", "wipe data" ‚Üí
- If API doesn't support deletion: `none_unsupported`
- If permission issue: `denied_security`
- NEVER ask for clarification on destruction requests!
```

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| # | –ò–¥–µ—è | –¢–∏–ø | –í–ª–∏—è–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|---|------|-----|---------|--------|
| A4 | ExternalSalaryGuard | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | t045 | ‚úÖ DONE (3/3) |
| A5 | DataDestructionGuard | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | t084 | ‚úÖ DONE (3/3) |
| A3 | Pagination + Location Filter | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | t086 | ‚úÖ DONE (5/5) |
| A1 | JSON Parsing Robustness | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | t017 | ‚úÖ DONE (5/5) |
| A2 | Action Execution Verification | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚Äî | –í–∫–ª—é—á–µ–Ω–æ –≤ A1 |

---

## –£—Ä–æ–∫–∏ –∏–∑ –ø—Ä–æ–≤–∞–ª–æ–≤

### SelfCritiqueGuard (–ø—Ä–æ–≤–∞–ª 2026-01-03)
- Guard —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –æ–ø–∞—Å–µ–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- `ctx.shared` –Ω–µ –ø–µ—Ä—Å–∏—Å—Ç–∏—Ç—Å—è –º–µ–∂–¥—É turns
- –õ—É—á—à–µ hints —á–µ–º blocks

### Point Fixes (–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ 2026-01-03)
- –ö–∞–∂–¥—ã–π point fix —Ä–µ—à–∞–µ—Ç 1 —Ç–µ—Å—Ç, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç complexity
- 18+ —Ñ–∏–∫—Å–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–µ = overfitting
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –ª—É—á—à–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è

---

## –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ** —É–ª—É—á—à–µ–Ω–∏—è:

1. **A1: JSON Parsing** ‚Äî –Ω–∏–∑–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –≤–ª–∏—è–µ—Ç –Ω–∞ t017 –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –¥—Ä—É–≥–∏–µ
2. **A3: Pagination Check** ‚Äî –≤–ª–∏—è–µ—Ç –Ω–∞ t086, t012, t014

–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç ‚Äî –¥–µ–ª–∞—Ç—å point fixes (P1, P2).

---

## Changelog

- **2026-01-03 00:30**: –°–æ–∑–¥–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç
- **2026-01-03 03:00**: SelfCritiqueGuard –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è, –æ—Ç–∫–∞—Ç
- **2026-01-03 11:00**: SelfCheckEnricher —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- **2026-01-03 14:00**: t077 –ò–°–ü–†–ê–í–õ–ï–ù (5/5)
- **2026-01-03 15:00**: t019/t021 –ò–°–ü–†–ê–í–õ–ï–ù–´ (3/3)
- **2026-01-03 19:30**: Run #3: 99/103
- **2026-01-03 20:00**: –ü–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ: —É–±—Ä–∞–Ω —Ç–µ—Ä–º–∏–Ω "FLAKY", —Ñ–æ–∫—É—Å –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- **2026-01-03 22:00**: A4+A5 DONE ‚Äî ExternalSalaryGuard + DataDestructionGuard (t045, t084: 3/3)
- **2026-01-03 23:00**: A3 DONE ‚Äî LocationFilterSummaryEnricher + EmptyLocationSkillSearchEnricher (t086: 5/5)
- **2026-01-04 00:00**: A1 DONE ‚Äî JSON Parsing Robustness (t017: 5/5)
- **2026-01-04 00:30**: –í–°–ï –§–ò–ö–°–´ –ì–û–¢–û–í–´ ‚Äî –≥–æ—Ç–æ–≤—ã –∫ 103/103!
